@using Microsoft.AspNetCore.Components.Forms

<h3>Bild hochladen</h3>

<InputFile OnChange="HandleSelected" />
<button @onclick="SaveImageToDatabase">Save</button>

@if (!string.IsNullOrEmpty(base64Image))
{
    <img src="@base64Image" alt="Ausgewähltes Bild" style="max-width: 100%; height: auto;" />
}

@code {
    private ElementReference inputFile;
    private string base64Image;

    // private void OpenFileDialog()
    // {
    //     inputFile.Element.Click();
    // }

    private async Task HandleSelected(InputFileChangeEventArgs e)
    {
        var file = e.File;
        var resizedImageFile = await file.RequestImageFileAsync("image/png", 800, 600);
        var buffer = new byte[resizedImageFile.Size];
        using (var stream = resizedImageFile.OpenReadStream())
        {
            await stream.ReadAsync(buffer, 0, buffer.Length);
        }
        base64Image = $"data:image/png;base64,{Convert.ToBase64String(buffer)}";

        // Hier rufst du die Methode zum Speichern in die Datenbank auf
        await SaveImageToDatabase();
    }

    private Task SaveImageToDatabase()
    {

        var hola = base64Image;
        // Hier sollte der Code zum Speichern des Bildes in der Datenbank stehen
        // Zum Beispiel:
        // var image = new Image { Base64Data = base64Image };
        // await imageRepository.SaveAsync(image);
        return Task.CompletedTask;
    }
}